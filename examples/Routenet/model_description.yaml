# Definition of the entities
entities:
- name: link
  hidden_state_dimension: hidden_state_dim
  features: [link_capacity]
- name: path
  hidden_state_dimension: hidden_state_dim
  features: [traffic]

# Definition of the message passing phase
message_passing:
  num_iterations: N
  stages:
    # STAGE 1:
    - stage_message_passings:
      # links to paths
      - destination_entity: path
        source_entities:
          - name: link
            adj_vector: adj_links_paths
            message:
              - type: direct_assignation
        aggregation:
          type: ordered
        update:
          type: recurrent_neural_network
          nn_name: recurrent1

    # STAGE 2:
    - stage_message_passings:
      # paths to links
      - destination_entity: link
        source_entities:
        - name: path
          adj_vector: adj_paths_links
          message:
          - type: direct_assignation
        aggregation:
          type: sum
        update:
          type: recurrent_neural_network
          nn_name: recurrent1

# Definition of the readout
readout:
- type: feed_forward
  input: [path]
  nn_name: readout_model
  output_label: delay

# Definition of the Neural Networks
neural_networks:
# Feed forward model
- nn_name: readout_model
  nn_type: feed_forward
  nn_architecture:
  - name: 1st_dense_layer
    type_layer: Dense
    units: readout_units
    kernel_regularizer: r_l2
    activation: selu
  - name: 2nd_dense_layer
    type_layer: Dense
    units: readout_units
    kernel_regularizer: r_l2
    activation: selu
  - name: Output
    type_layer: Dense
    units: output_units
    kernel_regularizer: r_l2_2
    activation: selu

# RNN model
- nn_name: recurrent1
  nn_type: recurrent_neural_network
  recurrent_type: GRU
