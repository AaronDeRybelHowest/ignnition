# Definition of the entities
entities:
- name: AS
  state_dimension: 32
  initial_state:
    - type: build_state
      input:
        - $sent

# Definition of the message passing phase
message_passing:
  num_iterations: 4
  stages:
    # STAGE 1:
    - stage_message_passings:
      - destination_entity: AS
        source_entities:
          - name: AS
            message:
              - type: neural_network
                nn_name: message_function
                input:
                  - source
                  - destination
        aggregation:
          - type: convolution
        update:
          type: neural_network
          nn_name: update_function

# Definition of the readout
readout:
- type: neural_network
  input: [AS]
  nn_name: readout_model
  output_name: hidden_state

- type: pooling
  type_pooling: mean
  input: [hidden_state]
  output_name: graph_state

- type: neural_network
  input: [graph_state]
  nn_name: readout_graph
  output_label: [$anomaly]

# Definition of the Neural Networks
neural_networks:
# Feed forward model
- nn_name: readout_model
  nn_architecture:
  - type_layer: Dense
    units: 32
    activation: relu
  - type_layer: Dense
    units: 32
    activation: relu
  - type_layer: Dense
    units: 32

- nn_name: message_function
  nn_architecture:
  - type_layer: Dense
    units: 32
    activation: relu
  - type_layer: Dense
    units: 32
    activation: relu

- nn_name: readout_graph
  nn_architecture:
  - type_layer: Dense
    units: 32
    activation: relu
  - type_layer: Dense
    units: 32
    activation: relu
  - type_layer: Dense
    units: 1
    activation: sigmoid

# RNN model
- nn_name: update_function
  nn_architecture:
    - type_layer: GRU